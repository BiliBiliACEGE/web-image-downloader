<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="optTitle"></title>
  <link rel="stylesheet" href="styles/options.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <img src="../icons/48.png" alt="Logo" class="logo"/>
      <h1 class="title" data-i18n="extName"></h1>
    </header>

    <nav class="nav-tabs">
      <button class="nav-tab active" data-tab="general" data-i18n="optGeneral"></button>
      <button class="nav-tab" data-tab="rules" data-i18n="optRules"></button>
      <button class="nav-tab" data-tab="advanced" data-i18n="optAdvanced"></button>
      <button class="nav-tab" data-i18n="optAbout" data-tab="about"></button>
    </nav>

    <main class="main">
      <!-- Â∏∏ËßÑËÆæÁΩÆ -->
      <div id="general" class="tab-content active">
        <section class="section">
          <h2 class="section-title" data-i18n="optGeneral"></h2>

          <div class="form-group">
            <label data-i18n="optLanguage"></label>
            <select id="languageSelect" class="form-select">
              <option value="auto" data-i18n="optLangAuto"></option>
              <option value="en" data-i18n="optLangEN"></option>
              <option value="zh_CN" data-i18n="optLangZHCN"></option>
              <option value="zh_TW" data-i18n="optLangZHTW"></option>
            </select>
            <p class="form-help" id="langHelp" data-i18n="optLangReload" style="display:none;color:#d13438;"></p>
          </div>

          <div class="form-group">
            <label data-i18n="optDownloadMode"></label>
            <select id="downloadMode" class="form-select">
              <option value="direct" data-i18n="optDirect"></option>
              <option value="newTab" data-i18n="optNewTab"></option>
              <option value="batch" data-i18n="optBatch"></option>
              <option value="copy" data-i18n="optCopy"></option>
            </select>
            <p class="form-help" data-i18n="optDownloadModeHelp"></p>
          </div>

          <div class="form-group">
            <label data-i18n="optFileNameTpl"></label>
            <input type="text" id="fileNameTemplate" class="form-input" placeholder="{original}">
            <p class="form-help" data-i18n="optFileNameTplHelp"></p>
          </div>

          <div class="form-group">
            <label data-i18n="optMaxFileLen"></label>
            <input type="number" id="maxFileNameLength" class="form-input" min="10" max="255" value="50">
            <p class="form-help" data-i18n="optMaxFileLenHelp"></p>
          </div>

          <div class="form-group">
            <label data-i18n="optNamingPattern"></label>
            <select id="namingPattern" class="form-select">
              <option value="original" data-i18n="optOriginal"></option>
              <option value="timestamp" data-i18n="optTimestamp"></option>
              <option value="domain" data-i18n="optDomain"></option>
              <option value="custom" data-i18n="optCustom"></option>
            </select>
          </div>

          <div id="customNamingGroup" class="form-group" style="display:none;">
            <label data-i18n="optCustomPattern"></label>
            <input type="text" id="customNaming" class="form-input" placeholder="{domain}_{timestamp}_{index}">
            <p class="form-help" data-i18n="optCustomPatternHelp"></p>
          </div>

          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="showNotifications">
              <span class="checkmark"></span>
              <span data-i18n="optShowNotify"></span>
            </label>
          </div>

          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="enableContextMenu">
              <span class="checkmark"></span>
              <span data-i18n="optContextMenu"></span>
            </label>
          </div>

          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="autoCloseTab">
              <span class="checkmark"></span>
              <span data-i18n="optAutoClose"></span>
            </label>
          </div>
        </section>
      </div>

      <!-- ËßÑÂàôËÆæÁΩÆ -->
      <div id="rules" class="tab-content">
        <section class="section">
          <div class="section-header">
            <h2 class="section-title" data-i18n="optRules"></h2>
            <button id="addRule" class="btn btn-primary" data-i18n="optAddRule"></button>
          </div>

          <!-- Ê®°ÂºèÂàáÊç¢ -->
          <div class="mode-switch">
            <button id="blockModeBtn" class="mode-btn active" data-i18n="optBlockMode"></button>
            <button id="codeModeBtn"  class="mode-btn" data-i18n="optCodeMode"></button>
          </div>

            <!-- === ÁßØÊú®Ê®°Âºè === -->
            <div id="blockMode" class="mode-panel active">
              <div id="blockEditor" class="block-editor">
                <div class="block-pool">
                  <div class="block" data-pattern="@[^?]+" data-repl="" title="Remove @ params">üóëÔ∏è ÂéªÊéâ@ÂèÇÊï∞</div>
                  <div class="block" data-pattern="\/thumbnail$" data-repl="" title="Remove thumbnail">üóëÔ∏è ÂéªÊéâÁº©Áï•Âõæ</div>
                  <div class="block" data-pattern="\/small$" data-repl="/large" title="Êç¢Â§ßÂõæ">üîç Êç¢ÊàêÂ§ßÂõæ</div>
                  <div class="block" data-pattern="_([sm]|xs|md|lg)$" data-repl="" title="ÂéªÊéâÂ∞∫ÂØ∏ÂêéÁºÄ">üìè ÂéªÊéâÂ∞∫ÂØ∏ÂêéÁºÄ</div>
                  <div class="block" data-pattern="[?&](width|height|size|format|quality)=\\d+" data-repl="" title="Ê∏ÖÂ∞∫ÂØ∏ÂèÇÊï∞">üìê Ê∏ÖÂ∞∫ÂØ∏ÂèÇÊï∞</div>
                  <div class="block" data-pattern="[?&]thumb(nail)?=" data-repl="" title="Ê∏ÖÁº©Áï•Ê†áËÆ∞">üóëÔ∏è Ê∏ÖÁº©Áï•Ê†áËÆ∞</div>
                </div>
                <div id="buildArea" class="build-area">
                  <p class="empty-hint" data-i18n="optDragHere"></p>
                </div>
                <input type="text" id="buildDomain" class="form-input" placeholder="ÂüüÂêçÔºàÁïôÁ©∫=ÈÄöÁî®Ôºâ">
                <button id="buildToRule" class="btn btn-primary" data-i18n="optGenerateRule"></button>
              </div>
            </div>

            <!-- === ÂéüÁîüÁºñËæë === -->
            <div id="codeMode" class="mode-panel">
              <div id="rulesContainer"></div>
            </div>

          <section class="section">
            <h2 class="section-title" data-i18n="optRuleTest"></h2>
            <div class="test-area">
              <div class="form-group">
                <label data-i18n="optTestUrl"></label>
                <input type="text" id="testUrl" class="form-input" placeholder="https://example.com/img.jpg">
              </div>
              <button id="testRule" class="btn btn-secondary" data-i18n="optTestBtn"></button>
              <div id="testResult" class="test-result"></div>
            </div>
          </section>
        </section>
      </div>

      <!-- È´òÁ∫ßËÆæÁΩÆ -->
      <div id="advanced" class="tab-content">
        <section class="section">
          <h2 class="section-title" data-i18n="optAdvanced"></h2>
          <div class="form-group">
            <label data-i18n="optConcurrent"></label>
            <input type="number" id="concurrentDownloads" class="form-input" min="1" max="10" value="3">
            <p class="form-help" data-i18n="optConcurrentHelp"></p>
          </div>
          <div class="form-group">
            <label data-i18n="optDelay"></label>
            <input type="number" id="downloadDelay" class="form-input" min="0" max="5000" value="500">
            <p class="form-help" data-i18n="optDelayHelp"></p>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="enableReferrer">
              <span class="checkmark"></span>
              <span data-i18n="optReferrer"></span>
            </label>
          </div>
          <div class="form-group">
            <label class="form-checkbox">
              <input type="checkbox" id="enableCustomHeaders">
              <span class="checkmark"></span>
              <span data-i18n="optCustomHdr"></span>
            </label>
          </div>
          <div id="customHeaders" class="custom-headers" style="display:none;">
            <label data-i18n="optHdrJson"></label>
            <textarea id="headersJson" class="form-textarea" rows="5" placeholder='{"User-Agent": "Mozilla/5.0..."}'></textarea>
          </div>
        </section>

        <section class="section">
          <h2 class="section-title" data-i18n="optDataMgmt"></h2>
          <div class="form-group">
            <button id="exportSettings" class="btn btn-secondary" data-i18n="optExport"></button>
            <button id="importSettings" class="btn btn-secondary" data-i18n="optImport"></button>
            <input type="file" id="importFile" accept=".json" style="display:none;">
          </div>
          <div class="form-group">
            <button id="resetSettings" class="btn btn-danger" data-i18n="optReset"></button>
            <button id="clearHistory" class="btn btn-danger" data-i18n="optClearHist"></button>
          </div>
        </section>
      </div>

      <!-- ÂÖ≥‰∫é -->
      <div id="about" class="tab-content">
        <section class="section">
          <div class="about-content">
            <img src="../icons/128.png" alt="Logo" class="about-logo"/>
            <h2 data-i18n="extName"></h2>
            <p class="version">v1.0.0</p>
            <p class="description" data-i18n="extDesc"></p>
            <div class="features">
              <h3 data-i18n="optFeatures"></h3>
              <ul>
                <li data-i18n="optFeat1"></li>
                <li data-i18n="optFeat2"></li>
                <li data-i18n="optFeat3"></li>
                <li data-i18n="optFeat4"></li>
                <li data-i18n="optFeat5"></li>
              </ul>
            </div>
            <div class="links">
              <a href="https://github.com/BiliBiliACEGE/web-image-downloader/blob/main/readme.md" id="helpLink" data-i18n="optHelp"></a>
              <a href="https://github.com/BiliBiliACEGE/web-image-downloader/issues" id="feedbackLink" data-i18n="optFeedback"></a>
              <a href="https://github.com/BiliBiliACEGE/web-image-downloader" id="rateLink" data-i18n="optRate"></a>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="footer">
      <button id="saveSettings" class="btn btn-primary" data-i18n="optSave"></button>
      <button id="resetSettings" class="btn btn-secondary" data-i18n="optReset"></button>
    </footer>
  </div>

  <!-- ËßÑÂàôÁºñËæëÂô®Ê®°ÊÄÅÊ°Ü -->
  <div id="ruleEditor" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 data-i18n="optEditRule"></h3>
        <button class="modal-close" id="closeEditor">&times;</button>
      </div>
      <form id="ruleForm" class="modal-body">
        <div class="form-group">
          <label data-i18n="optRuleDomain"></label>
          <input type="text" id="ruleDomain" class="form-input" placeholder="example.com">
        </div>
        <div class="form-group">
          <label data-i18n="optRulePattern"></label>
          <textarea id="rulePattern" class="form-textarea regex-input" rows="4" placeholder="Ê≠£ÂàôË°®ËææÂºè"></textarea>
        </div>
        <div class="form-group">
          <label data-i18n="optRuleReplacement"></label>
          <input type="text" id="ruleReplacement" class="form-input" placeholder="$1">
        </div>
        <div class="form-group">
          <label data-i18n="optRuleDesc"></label>
          <input type="text" id="ruleDesc" class="form-input" placeholder="ÁÆÄÁü≠ÊèèËø∞ÔºàÂèØÈÄâÔºâ">
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" data-i18n="optSave"></button>
          <button type="button" class="btn btn-secondary" id="cancelRuleForm" data-i18n="optCancel"></button>
        </div>
      </form>
    </div>
  </div>

  <script src="options.js"></script>
</body>
</html>